<!DOCTYPE html>
<html>
	<head>
		<title>Survey!</title>
		<!-- Latest compiled and minified CSS & JS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
		<script src="https://code.jquery.com/jquery.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous">
		</script>
		<!-- Chosen -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.css">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.jquery.min.js"></script>
	</head>
	<body>
		<div class="container">
			<div class="jumbotron">
				<h2>Survey Questions</h2>
			</div>
			<h3><strong>About You</strong></h3>
			<h4>Name (required)</h4>
			<input type="text" name="name" id="name-input">
			<h4>Link to photo (required)</h4>
			<input type="text" name="photo" id="photo-link">
			<h3><strong>Questions</strong></h3>
			<h4>You love web design.</h4>
			<select data-placeholder="" class="chosen-select" id="q1">
				<option value=""></option>
				<option value="1">1 (Strongly Disagree)</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5 (Strongly Agree)</option>
			</select>
			<h4>You work well under pressure.</h4>
			<select data-placeholder="" class="chosen-select" id="q2">
				<option value=""></option>
				<option value="1">1 (Strongly Disagree)</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5 (Strongly Agree)</option>
			</select>
			<h4>Sports are a big part of your life.</h4>
			<select data-placeholder="" class="chosen-select" id="q3">
				<option value=""></option>
				<option value="1">1 (Strongly Disagree)</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5 (Strongly Agree)</option>
			</select>
			<h4>Scify is one of your favorite things to watch.</h4>
			<select data-placeholder="" class="chosen-select" id="q4">
				<option value=""></option>
				<option value="1">1 (Strongly Disagree)</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5 (Strongly Agree)</option>
			</select>
			<h4>Imagination is important to you.</h4>
			<select data-placeholder="" class="chosen-select" id="q5">
				<option value=""></option>
				<option value="1">1 (Strongly Disagree)</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5 (Strongly Agree)</option>
			</select>
			<h4>You are a people person.</h4>
			<select data-placeholder="" class="chosen-select" id="q6">
				<option value=""></option>
				<option value="1">1 (Strongly Disagree)</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5 (Strongly Agree)</option>
			</select>
			<h4>You believe in freedom of speech.</h4>
			<select data-placeholder="" class="chosen-select" id="q7">
				<option value=""></option>
				<option value="1">1 (Strongly Disagree)</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5 (Strongly Agree)</option>
			</select>
			<h4>Computers are interesting to you.</h4>
			<select data-placeholder="" class="chosen-select" id="q8">
				<option value=""></option>
				<option value="1">1 (Strongly Disagree)</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5 (Strongly Agree)</option>
			</select>
			<h4>You enjoy working in groups.</h4>
			<select data-placeholder="" class="chosen-select" id="q9">
				<option value=""></option>
				<option value="1">1 (Strongly Disagree)</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5 (Strongly Agree)</option>
			</select>
			<h4>The last homework assignment was difficult for you.</h4>
			<select data-placeholder="" class="chosen-select" id="q10">
				<option value=""></option>
				<option value="1">1 (Strongly Disagree)</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5 (Strongly Agree)</option>
			</select>
			<hr>
			<button id="submit-btn" style="width: 100%; height: 50px;">Submit Answers!</button>
			<hr>
		</div>
		<footer class="footer">
			<div class="container">
				<p><a href="/api/friends">API Friends List</a> | <a href="https://github.com/alexdyagilev/FriendFinder">GitHub Repo</a></p>
			</div>
		</footer>
		<hr>
		<div id="resultsModal" class="modal fade" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h2 class="modal-title"><strong>Best Match For You</strong></h2>
					</div>
					<div class="modal-body">
						<h2 id="matchName"></h2>
						<img id="matchImg" src="" alt="">
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
		<script type="text/javascript">
		
			function compare(userData,jsonItem){ //Takes in data you entered and compares to other people
				var total = 50;
				var indexBest = 0;
				for(i = 0; i < jsonItem.length; i++){ //loops through object (people)
					var difference = 0;
					for(k = 0; k < 10; k++){ //loops through questions 1-10 and takes absolute value
						difference += Math.abs(parseInt(userData.scores[k]) - parseInt(jsonItem[i].scores[k]));
					}
					if(difference <= total){ //if new loop provides less difference, it becomes new total
						total = difference;
						indexBest = i; //this is the best match so far
					}
				}
					return indexBest;
			}
			$("#submit-btn").on("click", function(){ //Takes in the answers you have given
				var userData = {
				name: $("#name-input").val(),
				photo: $("#photo-link").val(),
				scores: [$("#q1").val(), $("#q2").val(), $("#q3").val(), $("#q4").val(), $("#q5").val(), $("#q6").val(), $("#q7").val(), $("#q8").val(), $("#q9").val(), $("#q10").val(), ]
			}
				console.log("Start JS");
		function validateForm() { //form validation
			var isValid = true;
			$('.form-control').each(function() {
			if ( $(this).val() === '' )
			isValid = false;
			});
			$('.chosen-select').each(function() {
				if( $(this).val() === "")
					isValid = false
			})
			return isValid;
			}
			var currentURL = window.location.origin;
			if (validateForm() == true) //only works if all questions have been answered
			{
				var json = [];
				$.get(currentURL + "/api/friends", function(data){
					var returned = compare(userData,data);
				$("#matchName").text(data[returned].name);
				$('#matchImg').attr("src", data[returned].photo);
				// Show the modal with the best match
				$("#resultsModal").modal('toggle');
				});
			$.post(currentURL + "/api/friends", userData, function(data){
				// Grab the result from the AJAX post so that the best match's name and photo are displayed.
				// $("#matchName").text(data.name);
				// $('#matchImg').attr("src", data.photo);
				// // Show the modal with the best match
				// $("#resultsModal").modal('toggle');
			});
			}
			else
			{
				alert("Please fill out all fields before submitting!"); //if all questions not answered
			}
		return false;
		});
		</script>
	</body>
</html>